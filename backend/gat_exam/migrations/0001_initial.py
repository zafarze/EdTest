# Generated by Django 6.0 on 2026-02-02 11:08

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='AIPrompt',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('slug', models.SlugField(help_text='Например: question_audit', unique=True, verbose_name='Код (ключ)')),
                ('name', models.CharField(max_length=100, verbose_name='Название промпта')),
                ('model_name', models.CharField(default='gpt-4o', max_length=50, verbose_name='Модель OpenAI')),
                ('temperature', models.FloatField(default=0.3, verbose_name='Креативность (0-1)')),
                ('system_role', models.TextField(help_text='Ты — строгий учитель...', verbose_name='Роль (System)')),
                ('user_template', models.TextField(help_text='Используй {text}, {choices} как переменные', verbose_name='Шаблон (User)')),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'AI Промпт',
                'verbose_name_plural': 'AI Промпты',
            },
        ),
        migrations.CreateModel(
            name='ExamRound',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, verbose_name='Название раунда')),
                ('date', models.DateField(verbose_name='Дата проведения')),
                ('is_active', models.BooleanField(default=True, verbose_name='Активен?')),
                ('target_easy_pct', models.PositiveIntegerField(default=40, verbose_name='% Легких')),
                ('target_medium_pct', models.PositiveIntegerField(default=40, verbose_name='% Средних')),
                ('target_hard_pct', models.PositiveIntegerField(default=20, verbose_name='% Сложных')),
                ('allow_duplicates', models.BooleanField(default=False, verbose_name='Разрешить повторы?')),
                ('max_duplicate_pct', models.PositiveIntegerField(default=10, verbose_name='Макс % повторов (если разрешено)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
            options={
                'verbose_name': 'Раунд Экзамена (Config)',
                'verbose_name_plural': 'Раунды Экзаменов',
            },
        ),
        migrations.CreateModel(
            name='GlobalSettings',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('site_name', models.CharField(default='GAT Premium Platform', max_length=100, verbose_name='Название платформы')),
                ('language', models.CharField(choices=[('ru', 'Русский'), ('tj', 'Тоҷикӣ'), ('en', 'English')], default='ru', max_length=10, verbose_name='Язык по умолчанию')),
                ('timezone', models.CharField(default='dushanbe', max_length=50, verbose_name='Часовой пояс')),
                ('logo', models.ImageField(blank=True, null=True, upload_to='branding/', verbose_name='Логотип')),
                ('current_year', models.CharField(default='2024-2025', max_length=20, verbose_name='Текущий учебный год')),
                ('grading_system', models.CharField(choices=[('100', '100-балльная'), ('5', '5-балльная'), ('letters', 'Буквенная')], default='100', max_length=20, verbose_name='Система оценивания')),
                ('pass_mark', models.IntegerField(default=60, verbose_name='Порог прохождения (%)')),
                ('maintenance_mode', models.BooleanField(default=False, help_text='Если включено, доступ только у админов', verbose_name='Режим обслуживания')),
                ('allow_registration', models.BooleanField(default=False, verbose_name='Разрешить регистрацию')),
                ('force_2fa', models.BooleanField(default=False, verbose_name='Принудительная 2FA для админов')),
                ('email_alerts', models.BooleanField(default=True, verbose_name='Email уведомления')),
                ('smtp_host', models.CharField(blank=True, default='smtp.gmail.com', max_length=100, verbose_name='SMTP Host')),
                ('telegram_bot_token', models.CharField(blank=True, max_length=200, verbose_name='Telegram Token')),
                ('theme', models.CharField(default='light', max_length=10, verbose_name='Тема')),
                ('primary_color', models.CharField(default='indigo', max_length=20, verbose_name='Основной цвет')),
            ],
            options={
                'verbose_name': 'Настройки Системы',
                'verbose_name_plural': 'Настройки Системы',
            },
        ),
        migrations.CreateModel(
            name='Question',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('text', models.TextField(verbose_name='Текст вопроса')),
                ('image', models.ImageField(blank=True, null=True, upload_to='questions/', verbose_name='Изображение')),
                ('variant', models.CharField(choices=[('A', 'Вариант A'), ('B', 'Вариант B'), ('C', 'Вариант C'), ('D', 'Вариант D'), ('All', 'Для всех вариантов')], default='All', max_length=5, verbose_name='Вариант')),
                ('difficulty', models.CharField(choices=[('easy', 'Легкий'), ('medium', 'Стандартный'), ('hard', 'Сложный')], default='medium', max_length=10, verbose_name='Сложность')),
                ('points', models.PositiveIntegerField(default=1, verbose_name='Баллы')),
                ('question_type', models.CharField(choices=[('single', 'Один правильный ответ'), ('multiple', 'Несколько правильных'), ('true_false', 'Истина / Ложь'), ('short_answer', 'Краткий ответ'), ('essay', 'Эссе (Развернутый ответ)'), ('blanks', 'Заполнение пропусков'), ('matching', 'Сопоставление'), ('ordering', 'Сортировка')], default='single', max_length=20, verbose_name='Тип')),
            ],
            options={
                'verbose_name': 'Вопрос',
                'verbose_name_plural': 'Вопросы',
                'ordering': ['id'],
            },
        ),
        migrations.CreateModel(
            name='School',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('custom_id', models.CharField(blank=True, max_length=20, null=True, unique=True, verbose_name='Код школы (ID)')),
                ('banner', models.ImageField(blank=True, null=True, upload_to='school_banners/', verbose_name='Обложка (Баннер)')),
                ('name', models.CharField(db_index=True, max_length=100, verbose_name='Название (RU)')),
                ('address', models.CharField(blank=True, max_length=255, verbose_name='Адрес (RU)')),
                ('name_tj', models.CharField(blank=True, max_length=100, verbose_name='Название (TJ)')),
                ('address_tj', models.CharField(blank=True, max_length=255, verbose_name='Адрес (TJ)')),
                ('name_en', models.CharField(blank=True, max_length=100, verbose_name='Название (EN)')),
                ('address_en', models.CharField(blank=True, max_length=255, verbose_name='Адрес (EN)')),
                ('slug', models.SlugField(blank=True, unique=True, verbose_name='Уникальная ссылка (slug)')),
                ('logo', models.ImageField(blank=True, null=True, upload_to='school_logos/', verbose_name='Логотип')),
                ('phone', models.CharField(blank=True, max_length=20, verbose_name='Телефон')),
                ('email', models.EmailField(blank=True, max_length=254, verbose_name='Email школы')),
                ('primary_color', models.CharField(default='#7c3aed', max_length=7, verbose_name='Основной цвет (HEX)')),
                ('min_grade_level', models.PositiveIntegerField(default=1, verbose_name='Мин. класс')),
                ('max_grade_level', models.PositiveIntegerField(default=11, verbose_name='Макс. класс')),
                ('color_theme', models.CharField(choices=[('emerald', 'Emerald (Зеленый)'), ('blue', 'Blue (Синий)'), ('violet', 'Violet (Фиолетовый)'), ('amber', 'Amber (Оранжевый)'), ('rose', 'Rose (Розовый)'), ('cyan', 'Cyan (Голубой)')], default='blue', max_length=20, verbose_name='Цветовая тема (для сайта)')),
            ],
            options={
                'verbose_name': 'Школа',
                'verbose_name_plural': 'Школы',
            },
        ),
        migrations.CreateModel(
            name='SchoolYear',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=50, verbose_name='Название (RU)')),
                ('name_tj', models.CharField(blank=True, max_length=50, verbose_name='Название (TJ)')),
                ('name_en', models.CharField(blank=True, max_length=50, verbose_name='Название (EN)')),
                ('start_date', models.DateField(verbose_name='Дата начала')),
                ('end_date', models.DateField(verbose_name='Дата конца')),
                ('is_active', models.BooleanField(default=False, verbose_name='Текущий год')),
            ],
            options={
                'verbose_name': 'Учебный год',
                'verbose_name_plural': 'Учебные годы',
                'ordering': ['start_date'],
            },
        ),
        migrations.CreateModel(
            name='Subject',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, unique=True, verbose_name='Название предмета (RU)')),
                ('name_tj', models.CharField(blank=True, max_length=100, verbose_name='Название (TJ)')),
                ('name_en', models.CharField(blank=True, max_length=100, verbose_name='Название (EN)')),
                ('slug', models.SlugField(blank=True, unique=True, verbose_name='Код (slug)')),
                ('abbreviation', models.CharField(blank=True, help_text='Используется для авто-определения предмета при импорте Excel (Math, Eng)', max_length=10, null=True, unique=True, verbose_name='Сокращение (МАТ)')),
                ('category', models.CharField(choices=[('Точные науки', 'Точные науки'), ('Естественные науки', 'Естественные науки'), ('Гуманитарные', 'Гуманитарные'), ('Языки', 'Языки'), ('Искусство', 'Искусство'), ('Спорт', 'Спорт'), ('Другое', 'Другое')], default='Точные науки', max_length=50, verbose_name='Категория')),
                ('color', models.CharField(default='blue', max_length=20, verbose_name='Цвет (Slug)')),
                ('icon_type', models.CharField(default='default', max_length=20, verbose_name='Иконка (ID)')),
                ('is_active', models.BooleanField(default=True, verbose_name='Активен?')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
            options={
                'verbose_name': 'Предмет',
                'verbose_name_plural': 'Предметы',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='BookletSection',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('grade_level', models.PositiveIntegerField(default=11, verbose_name='Класс')),
                ('status', models.CharField(choices=[('draft', 'Черновик'), ('review', 'На проверке (AI)'), ('approved', 'Утверждено'), ('locked', 'Включено в буклет')], default='draft', max_length=20, verbose_name='Статус')),
                ('ai_validation_result', models.JSONField(blank=True, default=dict, verbose_name='Результат AI проверки')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('day', models.PositiveIntegerField(default=1, verbose_name='День проведения')),
                ('expert', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL, verbose_name='Ответственный эксперт')),
                ('round', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sections', to='gat_exam.examround', verbose_name='Раунд')),
            ],
            options={
                'verbose_name': 'Секция Буклета',
                'verbose_name_plural': 'Секции Буклета',
                'ordering': ['round', 'day', 'grade_level'],
            },
        ),
        migrations.CreateModel(
            name='MasterBooklet',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('is_generated', models.BooleanField(default=False, verbose_name='Сгенерирован?')),
                ('generated_at', models.DateTimeField(blank=True, null=True)),
                ('pdf_file', models.FileField(blank=True, null=True, upload_to='booklets/pdf/', verbose_name='Файл буклета')),
                ('round', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='master_booklet', to='gat_exam.examround', verbose_name='Раунд')),
                ('sections', models.ManyToManyField(related_name='included_in_booklets', to='gat_exam.bookletsection')),
            ],
            options={
                'verbose_name': 'Мастер-Буклет',
                'verbose_name_plural': 'Мастер-Буклеты',
            },
        ),
        migrations.CreateModel(
            name='Notification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=255, verbose_name='Заголовок')),
                ('message', models.TextField(verbose_name='Сообщение')),
                ('type', models.CharField(choices=[('info', 'Инфо'), ('success', 'Успех'), ('warning', 'Внимание'), ('error', 'Ошибка')], default='info', max_length=20, verbose_name='Тип')),
                ('is_read', models.BooleanField(default=False, verbose_name='Прочитано')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Дата создания')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='notifications', to=settings.AUTH_USER_MODEL, verbose_name='Кому')),
            ],
            options={
                'verbose_name': 'Уведомление',
                'verbose_name_plural': 'Уведомления',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Choice',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('text', models.CharField(max_length=255, verbose_name='Текст ответа')),
                ('is_correct', models.BooleanField(default=False, verbose_name='Верный?')),
                ('image', models.ImageField(blank=True, null=True, upload_to='choices/', verbose_name='Изображение')),
                ('question', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='choices', to='gat_exam.question')),
            ],
        ),
        migrations.CreateModel(
            name='QuestionHistory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('used_date', models.DateField()),
                ('question', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='usage_history', to='gat_exam.question')),
                ('round', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='gat_exam.examround')),
            ],
            options={
                'verbose_name': 'История использования',
                'verbose_name_plural': 'История использования',
            },
        ),
        migrations.CreateModel(
            name='Quarter',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=50, verbose_name='Название (RU)')),
                ('name_tj', models.CharField(blank=True, max_length=50, verbose_name='Название (TJ)')),
                ('name_en', models.CharField(blank=True, max_length=50, verbose_name='Название (EN)')),
                ('start_date', models.DateField()),
                ('end_date', models.DateField()),
                ('is_active', models.BooleanField(default=False)),
                ('school_year', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='quarters', to='gat_exam.schoolyear')),
            ],
            options={
                'ordering': ['start_date'],
            },
        ),
        migrations.CreateModel(
            name='SectionQuestion',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('order', models.PositiveIntegerField(default=0, verbose_name='Порядковый номер')),
                ('fixed_text', models.TextField(blank=True, verbose_name='Зафиксированный текст')),
                ('is_forced_by_director', models.BooleanField(default=False, verbose_name='Добавлен директором')),
                ('question', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='gat_exam.question')),
                ('section', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='section_questions', to='gat_exam.bookletsection', verbose_name='Секция')),
            ],
            options={
                'verbose_name': 'Вопрос секции',
                'verbose_name_plural': 'Вопросы секции',
                'ordering': ['order'],
                'unique_together': {('section', 'question')},
            },
        ),
        migrations.AddField(
            model_name='bookletsection',
            name='questions',
            field=models.ManyToManyField(related_name='in_sections', through='gat_exam.SectionQuestion', to='gat_exam.question'),
        ),
        migrations.CreateModel(
            name='StudentClass',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('grade_level', models.PositiveIntegerField(choices=[(0, '0'), (1, '1'), (2, '2'), (3, '3'), (4, '4'), (5, '5'), (6, '6'), (7, '7'), (8, '8'), (9, '9'), (10, '10'), (11, '11'), (12, '12'), (13, '13')], verbose_name='Параллель')),
                ('section', models.CharField(max_length=5, verbose_name='Литера (А, Б, В...)')),
                ('language', models.CharField(blank=True, default='Русский', max_length=50, verbose_name='Язык обучения')),
                ('school', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='classes', to='gat_exam.school', verbose_name='Школа')),
            ],
            options={
                'verbose_name': 'Класс',
                'verbose_name_plural': 'Классы',
                'ordering': ['grade_level', 'section'],
                'unique_together': {('school', 'grade_level', 'section')},
            },
        ),
        migrations.CreateModel(
            name='Student',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('custom_id', models.CharField(blank=True, db_index=True, max_length=50, null=True, verbose_name='ID Личного дела')),
                ('first_name_ru', models.CharField(max_length=50, verbose_name='Имя (RU)')),
                ('last_name_ru', models.CharField(max_length=50, verbose_name='Фамилия (RU)')),
                ('first_name_tj', models.CharField(blank=True, max_length=50, verbose_name='Имя (TJ)')),
                ('last_name_tj', models.CharField(blank=True, max_length=50, verbose_name='Фамилия (TJ)')),
                ('first_name_en', models.CharField(blank=True, max_length=50, verbose_name='Имя (EN)')),
                ('last_name_en', models.CharField(blank=True, max_length=50, verbose_name='Фамилия (EN)')),
                ('gender', models.CharField(choices=[('male', 'Мужской'), ('female', 'Женский')], default='male', max_length=10, verbose_name='Пол')),
                ('status', models.CharField(choices=[('active', 'Учится'), ('graduated', 'Выпускник'), ('expelled', 'Отчислен')], default='active', max_length=20, verbose_name='Статус')),
                ('username', models.CharField(blank=True, max_length=100, null=True, unique=True, verbose_name='Логин')),
                ('last_login', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('school', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='students', to='gat_exam.school', verbose_name='Школа')),
                ('student_class', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='students', to='gat_exam.studentclass', verbose_name='Класс')),
            ],
            options={
                'verbose_name': 'Ученик',
                'verbose_name_plural': 'Ученики',
                'ordering': ['last_name_ru', 'first_name_ru'],
            },
        ),
        migrations.CreateModel(
            name='Exam',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=255, verbose_name='Название')),
                ('description', models.TextField(blank=True, verbose_name='Описание')),
                ('grade_level', models.IntegerField(db_index=True, default=5, verbose_name='Параллель (5-11)')),
                ('question_order', models.JSONField(blank=True, default=dict, help_text='Критично для Варианта Б! Хранит соответствие: Номер в буклете -> ID вопроса', verbose_name='Порядок вопросов (Shuffle Map)')),
                ('gat_round', models.IntegerField(choices=[(1, 'GAT-1'), (2, 'GAT-2'), (3, 'GAT-3'), (4, 'GAT-4')], default=1, verbose_name='Номер GAT')),
                ('gat_day', models.IntegerField(choices=[(1, 'День 1'), (2, 'День 2')], default=1, verbose_name='День экзамена')),
                ('variant', models.CharField(choices=[('A', 'Вариант А (Master)'), ('B', 'Вариант Б (Shuffled)')], db_index=True, default='A', max_length=1, verbose_name='Вариант')),
                ('exam_type', models.CharField(choices=[('online', 'Online Exam'), ('offline', 'Offline (Paper)'), ('cambridge_ai', 'Cambridge AI')], default='online', max_length=20, verbose_name='Тип')),
                ('status', models.CharField(choices=[('planned', 'Планируется'), ('active', 'Идет экзамен'), ('grading', 'Идет проверка'), ('finished', 'Завершен')], default='planned', max_length=20, verbose_name='Статус')),
                ('date', models.DateField(blank=True, null=True, verbose_name='Дата проведения')),
                ('duration', models.PositiveIntegerField(default=60, verbose_name='Длительность (мин)')),
                ('is_adaptive', models.BooleanField(default=False)),
                ('lockdown_mode', models.BooleanField(default=False)),
                ('webcam_monitoring', models.BooleanField(default=False)),
                ('ai_audit_passed', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('quarter', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='gat_exam.quarter', verbose_name='Четверть')),
                ('questions', models.ManyToManyField(blank=True, related_name='assigned_exams', to='gat_exam.question', verbose_name='Вопросы')),
                ('school', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='exams', to='gat_exam.school', verbose_name='Школа')),
                ('school_year', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='exams', to='gat_exam.schoolyear', verbose_name='Учебный год')),
                ('classes', models.ManyToManyField(blank=True, related_name='exams', to='gat_exam.studentclass', verbose_name='Классы (Список)')),
                ('subjects', models.ManyToManyField(blank=True, related_name='exams', to='gat_exam.subject', verbose_name='Предметы')),
            ],
            options={
                'verbose_name': 'Экзамен',
                'verbose_name_plural': 'Экзамены',
                'unique_together': {('school', 'school_year', 'gat_round', 'gat_day', 'grade_level', 'variant')},
            },
        ),
        migrations.AddField(
            model_name='bookletsection',
            name='subject',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='booklet_sections', to='gat_exam.subject', verbose_name='Предмет'),
        ),
        migrations.CreateModel(
            name='Topic',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('quarter', models.PositiveIntegerField(choices=[(1, '1-я Четверть'), (2, '2-я Четверть'), (3, '3-я Четверть'), (4, '4-я Четверть')], verbose_name='Четверть')),
                ('grade_level', models.PositiveIntegerField(help_text='Например: 10', verbose_name='Класс (Параллель)')),
                ('title', models.CharField(max_length=255, verbose_name='Название темы')),
                ('description', models.TextField(blank=True, verbose_name='Описание')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('author', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_topics', to=settings.AUTH_USER_MODEL, verbose_name='Автор')),
                ('schools', models.ManyToManyField(related_name='topics', to='gat_exam.school', verbose_name='Школы')),
                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='topics', to='gat_exam.subject', verbose_name='Предмет')),
            ],
            options={
                'verbose_name': 'Тема',
                'verbose_name_plural': 'Темы',
                'ordering': ['grade_level', 'quarter', 'title'],
            },
        ),
        migrations.AddField(
            model_name='question',
            name='topic',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='questions', to='gat_exam.topic', verbose_name='Тема'),
        ),
        migrations.CreateModel(
            name='UserProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('role', models.CharField(choices=[('admin', 'Администратор'), ('general_director', 'Ген. Директор'), ('director', 'Директор'), ('deputy', 'Зам. директора'), ('expert', 'Эксперт/Методист'), ('teacher', 'Учитель')], default='teacher', max_length=20, verbose_name='Роль')),
                ('phone', models.CharField(blank=True, max_length=20, verbose_name='Телефон')),
                ('avatar', models.ImageField(blank=True, null=True, upload_to='avatars/')),
                ('assigned_classes', models.ManyToManyField(blank=True, related_name='homeroom_teachers', to='gat_exam.studentclass', verbose_name='Курируемые классы')),
                ('assigned_schools', models.ManyToManyField(blank=True, related_name='assigned_staff', to='gat_exam.school', verbose_name='Прикрепленные школы')),
                ('assigned_subjects', models.ManyToManyField(blank=True, related_name='assigned_experts', to='gat_exam.subject', verbose_name='Курируемые предметы')),
                ('school', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='staff_primary', to='gat_exam.school')),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='profile', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='ExamResult',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('score', models.FloatField(verbose_name='Итоговый балл')),
                ('max_score', models.FloatField(verbose_name='Макс. балл')),
                ('percentage', models.FloatField(default=0, verbose_name='Процент')),
                ('details', models.JSONField(blank=True, default=dict, verbose_name='Детали ответов')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('exam', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='results', to='gat_exam.exam')),
                ('student', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='results', to='gat_exam.student')),
            ],
            options={
                'unique_together': {('student', 'exam')},
            },
        ),
        migrations.CreateModel(
            name='QuestionLimit',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('grade_level', models.PositiveIntegerField(verbose_name='Класс')),
                ('count', models.PositiveIntegerField(default=0, verbose_name='Количество вопросов')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('school', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='question_limits', to='gat_exam.school', verbose_name='Школа')),
                ('subject', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='gat_exam.subject', verbose_name='Предмет')),
            ],
            options={
                'verbose_name': 'Лимит вопросов',
                'verbose_name_plural': 'Лимиты вопросов',
                'unique_together': {('school', 'grade_level', 'subject')},
            },
        ),
        migrations.AlterUniqueTogether(
            name='bookletsection',
            unique_together={('round', 'subject', 'grade_level', 'day')},
        ),
    ]
